<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
    
<mapper namespace="com.flour.web.mapper.DocumentPaymentMapper">
	
	<!-- 결제 첫화면 유저 이름,입사일  부서 아이디 ,부서이름 정보가져오기   -->
	<select id="userInfo" resultType="com.flour.web.domain.DocumentPayment">
      select a.USER_IDENNUM as userIdennum,
      a.USER_NAME as USERNAME, a.USER_CREATEDDATE as USERCREATEDDATE
      ,b.DEPARTMENT_ID as DEPARTMENTID, b.DEPARTMENT_NAME as DEPARTMENTNAME
	from USERS as a 
	inner join DEPARTMENT as b on a.DEPARTMENT_ID=b.DEPARTMENT_ID 
	where a.USER_IDENNUM=#{userIdennum};
    </select>
    
    
        <!--휴가신청서 모든 정보들 -->
	<select id="holidayList" resultType="com.flour.web.domain.DocumentPayment">
   	select DOCUMENT_HOLIDAY_NUM as DOCUMENTHOLIDAYNUM, USER_IDENNUM as userIdennum,
   	DOCUMENT_HOLIDAY_USERNAME as DOCUMENTHOLIDAYUSERNAME,
   	DOCUMENT_HOLIDAY_USERDEPARTMENT as DOCUMENTHOLIDAYUSERDEPARTMENT,
   	DOCUMENT_HOLIDAY_TITLE as DOCUMENTHOLIDAYTITLE,
   	DOCUMENT_HOLIDAY_SORT as DOCUMENTHOLIDAYSORT,
   	DOCUMENT_HOLIDAY_SUBMITDAY as DOCUMENTHOLIDAYSUBMITDAY,
   	DOCUMENT_HOLIDAY_STARTDAY as DOCUMENTHOLIDAYSTARTDAY,
   	DOCUMENT_HOLIDAY_ENDDAY as DOCUMENTHOLIDAYENDDAY,
   	DOCUMENT_HOLIDAY_CONTENT as DOCUMENTHOLIDAYCONTENT,
   	DOCUMENT_HOLIDAY_CHECK as DOCUMENTHOLIDAYCHECK,
   	DOCUMENT_HOLIDAY_STATUS as DOCUMENTHOLIDAYSTATUS,
   	DOCUMENT_HOLIDAY_PAYMENTDAY as DOCUMENTHOLIDAYPAYMENTDAY,
   	DOCUMENT_HOLIDAY_PAYMENTUSER as DOCUMENTHOLIDAYPAYMENTUSER,
   	DOCUMENT_HOLIDAY_PAYMENTDEPARTMENT as DOCUMENTHOLIDAYPAYMENTDEPARTMENT,
   	DOCUMENT_HOLIDAY_PAYMENTUSERID as DOCUMENTHOLIDAYPAYMENTUSERID
   	from DOCUMENT_HOLIDAY
   	order by DOCUMENT_HOLIDAY_SUBMITDAY DESC
    </select>	
	<!--업무보고서 모든 정보들 -->
	<select id="taskreportList" resultType="com.flour.web.domain.DocumentPayment">
    select DOCUMENT_TASKREPORT_NUM as DOCUMENTTASKREPORTNUM,
    USER_IDENNUM as userIdennum,
    DOCUMENT_TASKREPORT_USERNAME as DOCUMENTTASKREPORTUSERNAME,
    DOCUMENT_TASKREPORT_USERDEPARTMENT as DOCUMENTTASKREPORTUSERDEPARTMENT,
    DOCUMENT_TASKREPORT_TITLE as DOCUMENTTASKREPORTTITLE,
    DOCUMENT_TASKREPORT_TASKNAME as DOCUMENTTASKREPORTTASKNAME,
    DOCUMENT_TASKREPORT_SUBMITDAY as DOCUMENTTASKREPORTSUBMITDAY,
    DOCUMENT_TASKREPORT_STARTDAY as DOCUMENTTASKREPORTSTARTDAY,
    DOCUMENT_TASKREPORT_ENDDAY as DOCUMENTTASKREPORTENDDAY,
    DOCUMENT_TASKREPORT_PLAN as DOCUMENTTASKREPORTPLAN,
    DOCUMENT_TASKREPORT_SPECIALNOTE as DOCUMENTTASKREPORTSPECIALNOTE,
    DOCUMENT_TASKREPORT_SUGGESTIONS as DOCUMENTTASKREPORTSUGGESTIONS,
    DOCUMENT_TASKREPORT_CHECK as DOCUMENTTASKREPORTCHECK,
    DOCUMENT_TASKREPORT_STATUS as DOCUMENTTASKREPORTSTATUS,
    DOCUMENT_TASKREPORT_PAYMENTDAY as DOCUMENTTASKREPORTPAYMENTDAY,
    DOCUMENT_TASKREPORT_PAYMENTUSER as DOCUMENTTASKREPORTPAYMENTUSER,
    DOCUMENT_TASKREPORT_PAYMENTDEPARTMENT as DOCUMENTTASKREPORTPAYMENTDEPARTMENT,
    DOCUMENT_TASKREPORT_PAYMENTUSERID as DOCUMENTTASKREPORTPAYMENTUSERID 
    from DOCUMENT_TASKREPORT
    order by DOCUMENT_TASKREPORT_SUBMITDAY DESC 
    </select>	
	<!--사직서 모든 정보들 -->
    <select id="resignationList" resultType="com.flour.web.domain.DocumentPayment">
    select DOCUMENT_RESIGNATION_NUM as DOCUMENTRESIGNATIONNUM,
    USER_IDENNUM as userIdennum,
    DOCUMENT_RESIGNATION_USERNAME as DOCUMENTRESIGNATIONUSERNAME,
    DOCUMENT_RESIGNATION_USERDEPARTMENT as DOCUMENTRESIGNATIONUSERDEPARTMENT,
    DOCUMENT_RESIGNATION_USERCREATEDAY as DOCUMENTRESIGNATIONUSERCREATEDAY,
    DOCUMENT_RESIGNATION_TITLE as DOCUMENTRESIGNATIONTITLE,
    DOCUMENT_RESIGNATION_SUBMITDAY as DOCUMENTRESIGNATIONSUBMITDAY,
    DOCUMENT_RESIGNATION_RETIREMENTDAY as DOCUMENTRESIGNATIONRETIREMENTDAY,
    DOCUMENT_RESIGNATION_REASON as DOCUMENTRESIGNATIONREASON,
    DOCUMENT_RESIGNATION_CHECK as DOCUMENTRESIGNATIONCHECK,
    DOCUMENT_RESIGNATION_STATUS as DOCUMENTRESIGNATIONSTATUS,
    DOCUMENT_RESIGNATION_PAYMENTDAY as DOCUMENTRESIGNATIONPAYMENTDAY,
    DOCUMENT_RESIGNATION_PAYMENTUSER as DOCUMENTRESIGNATIONPAYMENTUSER,
    DOCUMENT_RESIGNATION_PAYMENTDEPARTMENT as DOCUMENTRESIGNATIONPAYMENTDEPARTMENT,
    DOCUMENT_RESIGNATION_PAYMENTUSERID as DOCUMENTRESIGNATIONPAYMENTUSERID
    from DOCUMENT_RESIGNATION
    order by DOCUMENT_RESIGNATION_SUBMITDAY DESC
    </select> 
    
    <!--휴가테이블 전부 check항목  null로 업데이트 시키기  -->
    <update id="holidayAllCheckNull">
    update DOCUMENT_HOLIDAY set DOCUMENT_HOLIDAY_CHECK=null
    </update>
    <!--업무보고서테이블 전부 check항목  null로 업데이트 시키기  -->
    <update id="taskreportAllCheckNull">
    update DOCUMENT_TASKREPORT set DOCUMENT_TASKREPORT_CHECK=null
    </update>
    <!--사직서테이블 전부 check항목  null로 업데이트 시키기  -->
	<update id="resignAllCheckNull">
	update DOCUMENT_RESIGNATION set DOCUMENT_RESIGNATION_CHECK=null
	</update>
    
    
	<!-- 휴가신청  -->
	<insert id="holidayInsert">
	insert into DOCUMENT_HOLIDAY(DOCUMENT_HOLIDAY_NUM,DOCUMENT_HOLIDAY_USERNAME
	, DOCUMENT_HOLIDAY_USERDEPARTMENT, DOCUMENT_HOLIDAY_TITLE
	,DOCUMENT_HOLIDAY_SORT, DOCUMENT_HOLIDAY_SUBMITDAY
	,DOCUMENT_HOLIDAY_STARTDAY, DOCUMENT_HOLIDAY_ENDDAY
	,DOCUMENT_HOLIDAY_CONTENT, DOCUMENT_HOLIDAY_STATUS ,USER_IDENNUM) 
	values (
	(SELECT 
        CONCAT(
            DATE_FORMAT(curdate(), '%Y%m%d'),
            '-1',
            (COALESCE(MAX(SUBSTRING(DOCUMENT_HOLIDAY_NUM, -3)) + 1, 1) + 1000)
        )
    FROM DOCUMENT_HOLIDAY as taskreportnum)
    ,#{DOCUMENTHOLIDAYUSERNAME}, #{DOCUMENTHOLIDAYUSERDEPARTMENT}
    ,#{DOCUMENTHOLIDAYTITLE} ,#{DOCUMENTHOLIDAYSORT} ,#{DOCUMENTHOLIDAYSUBMITDAY} 
    ,#{DOCUMENTHOLIDAYSTARTDAY},#{DOCUMENTHOLIDAYENDDAY},#{DOCUMENTHOLIDAYCONTENT}
    ,#{DOCUMENTHOLIDAYSTATUS},#{userIdennum}
	)	
	</insert>
	
	<!-- 업무보고서 insert -->
	<insert id="taskreportinsert">
	insert into DOCUMENT_TASKREPORT(DOCUMENT_TASKREPORT_NUM,DOCUMENT_TASKREPORT_USERNAME
	,DOCUMENT_TASKREPORT_USERDEPARTMENT, DOCUMENT_TASKREPORT_TITLE  
	,DOCUMENT_TASKREPORT_TASKNAME, DOCUMENT_TASKREPORT_SUBMITDAY
	,DOCUMENT_TASKREPORT_STARTDAY, DOCUMENT_TASKREPORT_ENDDAY
	,DOCUMENT_TASKREPORT_PLAN, DOCUMENT_TASKREPORT_SPECIALNOTE
	,DOCUMENT_TASKREPORT_SUGGESTIONS, DOCUMENT_TASKREPORT_STATUS, USER_IDENNUM)
	values(
	(SELECT 
        CONCAT(
            DATE_FORMAT(curdate(), '%Y%m%d'),
            '-2',
            (COALESCE(MAX(SUBSTRING(DOCUMENT_TASKREPORT_NUM, -3)) + 1, 1) + 1000)
        )
    FROM DOCUMENT_TASKREPORT as taskreportnum)
    ,#{DOCUMENTTASKREPORTUSERNAME},#{DOCUMENTTASKREPORTUSERDEPARTMENT}
    ,#{DOCUMENTTASKREPORTTITLE},#{DOCUMENTTASKREPORTTASKNAME}
    ,#{DOCUMENTTASKREPORTSUBMITDAY},#{DOCUMENTTASKREPORTSTARTDAY},#{DOCUMENTTASKREPORTENDDAY}
    ,#{DOCUMENTTASKREPORTPLAN},#{DOCUMENTTASKREPORTSPECIALNOTE},#{DOCUMENTTASKREPORTSUGGESTIONS}
    ,#{DOCUMENTTASKREPORTSTATUS},#{userIdennum}
	)
	</insert>
	
	<!-- 사직서 insert -->
    <insert id="resignationInsert">
    insert into DOCUMENT_RESIGNATION(DOCUMENT_RESIGNATION_NUM, DOCUMENT_RESIGNATION_USERNAME
    ,DOCUMENT_RESIGNATION_USERDEPARTMENT, DOCUMENT_RESIGNATION_USERCREATEDAY
    , DOCUMENT_RESIGNATION_TITLE, DOCUMENT_RESIGNATION_SUBMITDAY
    ,DOCUMENT_RESIGNATION_RETIREMENTDAY, DOCUMENT_RESIGNATION_REASON
    ,DOCUMENT_RESIGNATION_STATUS, USER_IDENNUM)
    values(
    (SELECT 
        CONCAT(
            DATE_FORMAT(curdate(), '%Y%m%d'),
            '-3',
            (COALESCE(MAX(SUBSTRING(DOCUMENT_RESIGNATION_NUM, -3)) + 1, 1) + 1000)
        )
    FROM DOCUMENT_RESIGNATION as taskreportnum)
    ,#{DOCUMENTRESIGNATIONUSERNAME},#{DOCUMENTRESIGNATIONUSERDEPARTMENT},#{DOCUMENTRESIGNATIONUSERCREATEDAY}
    ,#{DOCUMENTRESIGNATIONTITLE},#{DOCUMENTRESIGNATIONSUBMITDAY},#{DOCUMENTRESIGNATIONRETIREMENTDAY}
    ,#{DOCUMENTRESIGNATIONREASON},#{DOCUMENTRESIGNATIONSTATUS},#{userIdennum}
    )
    </insert>
     
     
    <!-- 체크언체크  --> 
   <!--휴가신청서 체크(AJAX) -->
    <update id="holidayCheck">
    update  DOCUMENT_HOLIDAY set DOCUMENT_HOLIDAY_CHECK="check" 
    where DOCUMENT_HOLIDAY_NUM=#{DOCUMENTHOLIDAYNUM}
    </update>
    <!--휴가신청서 체크해체(AJAX) -->
    <update id="holidayunCheck">
    update  DOCUMENT_HOLIDAY set DOCUMENT_HOLIDAY_CHECK=null 
    where DOCUMENT_HOLIDAY_NUM=#{DOCUMENTHOLIDAYNUM}
    </update>
	<!--  업무보고서 체크(AJAX) -->
	<update id="taskreportCheck">
	update  DOCUMENT_TASKREPORT set DOCUMENT_TASKREPORT_CHECK="check" 
    where DOCUMENT_TASKREPORT_NUM=#{DOCUMENTTASKREPORTNUM}
	</update>
    <!--업무보고서 체크해제(AJAX)  -->
    <update id="taskreportUnCheck">
	update  DOCUMENT_TASKREPORT set DOCUMENT_TASKREPORT_CHECK=null 
    where DOCUMENT_TASKREPORT_NUM=#{DOCUMENTTASKREPORTNUM}
	</update>
    <!--사직서 체크(AJAX) -->
    <update id="resignationCheck">
    update  DOCUMENT_RESIGNATION set DOCUMENT_RESIGNATION_CHECK="check" 
    where DOCUMENT_RESIGNATION_NUM=#{DOCUMENTRESIGNATIONNUM}
    </update>
    <!--사직서 체크해제(AJAX)  -->
    <update id="resignationUnCheck">
    update  DOCUMENT_RESIGNATION set DOCUMENT_RESIGNATION_CHECK=null 
    where DOCUMENT_RESIGNATION_NUM=#{DOCUMENTRESIGNATIONNUM}
    </update>

   <!--결재or반려 삭제 -->
   <delete id="paymentHolidayDelete">
   delete from DOCUMENT_HOLIDAY 
   where (DOCUMENT_HOLIDAY_STATUS="반려" 
   or DOCUMENT_HOLIDAY_STATUS="결재대기")
   and DOCUMENT_HOLIDAY_CHECK="check"
   </delete>
   <delete id="paymentTaskreportDelete">
   delete from DOCUMENT_TASKREPORT 
   where (DOCUMENT_TASKREPORT_STATUS="반려" 
   or DOCUMENT_TASKREPORT_STATUS="결재대기")
   and DOCUMENT_TASKREPORT_CHECK="check"
   </delete>
   <delete id="paymentResignDelete">
   delete from DOCUMENT_RESIGNATION 
   where (DOCUMENT_RESIGNATION_STATUS="반려" 
   or DOCUMENT_RESIGNATION_STATUS="결재대기")
   and DOCUMENT_RESIGNATION_CHECK="check"
   </delete>
    
</mapper>
